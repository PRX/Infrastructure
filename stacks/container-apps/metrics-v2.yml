# stacks/metrics.prx.org.yml
AWSTemplateFormatVersion: "2010-09-09"

Description: metrics.prx.org application running in Docker

Parameters:
  EnvironmentType:
    Type: String
  # VpcId:
  #   Type: AWS::EC2::VPC::Id

Resources:
  MetricsLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 14

  # MetricsTargetGroup:
  #   Type: AWS::ElasticLoadBalancingV2::TargetGroup
  #   Properties:
  #     HealthCheckIntervalSeconds: 15
  #     HealthCheckPath: /
  #     HealthCheckTimeoutSeconds: 5
  #     HealthyThresholdCount: 3
  #     UnhealthyThresholdCount: 3
  #     Port: 80
  #     Protocol: HTTP
  #     TargetGroupAttributes:
  #       - Key: deregistration_delay.timeout_seconds
  #         Value: "15"
  #     Tags:
  #       - Key: Project
  #         Value: Metrics
  #       - Key: Environment
  #         Value: !Ref EnvironmentType
  #       - Key: Name
  #         Value: !Sub Metrics-${EnvironmentType} # TODO
  #       - Key: prx:cloudformation:stack-name
  #         Value: !Ref AWS::StackName
  #       - Key: prx:cloudformation:stack-id
  #         Value: !Ref AWS::StackId
  #     VpcId: !Ref VpcId

  # MetricsALBHTTPSHostWildcardListenerRule:
  #   Type: AWS::ElasticLoadBalancingV2::ListenerRule
  #   Properties:
  #     Actions:
  #       - TargetGroupArn: !Ref MetricsTargetGroup
  #         Type: forward
  #     Conditions:
  #       - Field: host-header
  #         Values:
  #           - metrics.*
  #     ListenerArn: !Ref PlatformALBHTTPSListenerArn
  #     Priority: !Join ["", [!Ref PlatformALBListenerPriorityPrefix, "00"]]
