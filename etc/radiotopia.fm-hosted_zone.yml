AWSTemplateFormatVersion: "2010-09-09"
Description: >
  Hosted zone and record sets for radiotopia.fm
Parameters:
  Domain:
    Default: radiotopia.fm.
    Description: The domain name and hosted zone
    Type: String
Resources:
  HostedZone:
    Type: "AWS::Route53::HostedZone"
    Properties:
      HostedZoneConfig:
        Comment: Primary Radiotopia domain
      HostedZoneTags:
        - Key: Project
          Value: radiotopia.fm
      Name: !Ref Domain
  Text:
    DependsOn: HostedZone
    Type: "AWS::Route53::RecordSetGroup"
    Properties:
      # Route53 expects TXT record values to be enclosed in double quotes, so in
      # the YAML they need to be double-quoted.
      # Each domain name should only have a single text record. Add multiple
      # resource records if necessary.
      # All SPF records need to go into a single resource record.
      Comment: TXT Records
      HostedZoneName: !Ref Domain
      RecordSets:
        - ResourceRecords:
            - '"google-site-verification=zFRPkYoCbmLhpl-z3WCBzd0uUXdlP50m39evhsNZHKQ"'
            - '"v=spf1 include:mail.zendesk.com include:servers.mcsv.net ?all"'
          TTL: "300"
          Type: TXT
          Name: !Ref Domain
  GSuite:
    DependsOn: HostedZone
    Type: "AWS::Route53::RecordSetGroup"
    Properties:
      Comment: G Suite
      HostedZoneName: !Ref Domain
      RecordSets:
        - ResourceRecords:
            - "1 ASPMX.L.GOOGLE.COM."
            - "5 ALT1.ASPMX.L.GOOGLE.COM."
            - "5 ALT2.ASPMX.L.GOOGLE.COM."
            - "10 ASPMX2.GOOGLEMAIL.COM."
            - "10 ASPMX3.GOOGLEMAIL.COM."
          TTL: "300"
          Type: MX
          Name: !Ref Domain
  Squarespace:
    DependsOn: HostedZone
    Type: "AWS::Route53::RecordSetGroup"
    Properties:
      Comment: Squarespace
      HostedZoneName: !Ref Domain
      RecordSets:
        - ResourceRecords:
            - "198.185.159.144"
            - "198.185.159.145"
            - "198.49.23.144"
            - "198.49.23.145"
          TTL: "300"
          Type: A
          Name: !Ref Domain
        - ResourceRecords:
            - ext-cust.squarespace.com.
          TTL: "300"
          Type: CNAME
          Name: !Sub www.${Domain}
        - ResourceRecords:
            - verify.squarespace.com.
          TTL: "300"
          Type: CNAME
          Name: !Sub 8k7w47c5y878fddxzmfk.${Domain}
  MailChimp:
    DependsOn: HostedZone
    Type: "AWS::Route53::RecordSetGroup"
    Properties:
      Comment: MailChimp
      HostedZoneName: !Ref Domain
      RecordSets:
        - ResourceRecords:
            - dkim.mcsv.net.
          TTL: "300"
          Type: CNAME
          Name: !Sub k1._domainkey.${Domain}
  Feedburner:
    DependsOn: HostedZone
    Type: "AWS::Route53::RecordSetGroup"
    Properties:
      Comment: MailChimp
      HostedZoneName: !Ref Domain
      RecordSets:
        - ResourceRecords:
            - io25k.feedproxy.ghs.google.com.
          TTL: "300"
          Type: CNAME
          Name: !Sub feeds.${Domain}
  Media:
    DependsOn: HostedZone
    Type: "AWS::Route53::RecordSetGroup"
    Properties:
      Comment: Media server
      HostedZoneName: !Ref Domain
      RecordSets:
        - Type: A
          Name: !Sub media.${Domain}
          AliasTarget:
            DNSName: d20aun7mw4so9y.cloudfront.net
            # Global CloudFront hosted zone ID
            HostedZoneId: Z2FDTNDATAQYW2
        - Type: AAAA
          Name: !Sub media.${Domain}
          AliasTarget:
            DNSName: d20aun7mw4so9y.cloudfront.net
            # Global CloudFront hosted zone ID
            HostedZoneId: Z2FDTNDATAQYW2
  RadiotopiaRadio:
    DependsOn: HostedZone
    Type: "AWS::Route53::RecordSetGroup"
    Properties:
      Comment: Radiotopia Radio and API
      HostedZoneName: !Ref Domain
      RecordSets:
        - Type: A
          Name: !Sub radio.${Domain}
          AliasTarget:
            DNSName: di9gzgowz7p3e.cloudfront.net
            # Global CloudFront hosted zone ID
            HostedZoneId: Z2FDTNDATAQYW2
        - Type: AAAA
          Name: !Sub radio.${Domain}
          AliasTarget:
            DNSName: di9gzgowz7p3e.cloudfront.net
            # Global CloudFront hosted zone ID
            HostedZoneId: Z2FDTNDATAQYW2
        - Type: A
          Name: !Sub tower.${Domain}
          AliasTarget:
            DNSName: d2bc6y52zdgbr8.cloudfront.net
            # Global CloudFront hosted zone ID
            HostedZoneId: Z2FDTNDATAQYW2
        - Type: AAAA
          Name: !Sub tower.${Domain}
          AliasTarget:
            DNSName: d2bc6y52zdgbr8.cloudfront.net
            # Global CloudFront hosted zone ID
            HostedZoneId: Z2FDTNDATAQYW2
  Legacy:
    DependsOn: HostedZone
    Type: "AWS::Route53::RecordSetGroup"
    Properties:
      Comment: Radiotopia Radio and API
      HostedZoneName: !Ref Domain
      RecordSets:
        - Type: A
          Name: !Sub v1.${Domain}
          AliasTarget:
            DNSName: d1eoaqplfeeo8v.cloudfront.net
            # Global CloudFront hosted zone ID
            HostedZoneId: Z2FDTNDATAQYW2
        - Type: AAAA
          Name: !Sub v1.${Domain}
          AliasTarget:
            DNSName: d1eoaqplfeeo8v.cloudfront.net
            # Global CloudFront hosted zone ID
            HostedZoneId: Z2FDTNDATAQYW2
