# dns/prxtransfer.org-hosted_zone.yml
################################################################################
#### !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ########################################
#### THIS FILE IS CONTINUOUSLY DEPLOYED ########################################
#### !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ########################################
################################################################################
AWSTemplateFormatVersion: "2010-09-09"
Description: >-
  Hosted zone and record sets for prxtransfer.org

Parameters:
  Domain:
    Default: prxtransfer.org.
    Description: The domain name and hosted zone
    Type: String

Resources:
  HostedZone:
    Type: AWS::Route53::HostedZone
    Properties:
      HostedZoneConfig:
        Comment: Broadcast FTP pull delivery
      HostedZoneTags:
        - { Key: prx:meta:tagging-version, Value: "2021-04-07" }
        - { Key: prx:cloudformation:stack-name, Value: !Ref AWS::StackName }
        - { Key: prx:cloudformation:stack-id, Value: !Ref AWS::StackId }
        - { Key: prx:ops:environment, Value: Production }
        - { Key: prx:dev:application, Value: Broadcast Delivery }
      Name: !Ref Domain

  ProductionWildcards:
    Type: AWS::Route53::RecordSetGroup
    Properties:
      Comment: Production FTP domains
      HostedZoneId: !GetAtt HostedZone.Id
      RecordSets:
        # Production wildcard traffic. All production traffic from stations
        # would be expected to handled by one of these.
        #
        # THEY ALL RESOLVE TO THE SAME NETWORK LOAD BALANCER!!
        #
        # - prxtransfer.org (shouldn't be in use by anyone)
        # - *.prxtransfer.org (all legacy traffic)
        # - *.station.prxtransfer.org (stations that opted in to Transfer Family early)
        # - *.east.prxtransfer.org (Legacy routing for a few stations to hit specific server locations)
        # - *.west.prxtransfer.org (Legacy routing for a few stations to hit specific server location)
        # - *.west1.prxtransfer.org (Legacy routing for a few stations to hit specific server locations)
        - Name: !Ref Domain
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: A
        - Name: !Ref Domain
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: AAAA

        - Name: !Sub "*.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: A
        - Name: !Sub "*.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: AAAA

        - Name: !Sub "*.station.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: A
        - Name: !Sub "*.station.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: AAAA

        - Name: !Sub "*.east.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: A
        - Name: !Sub "*.east.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: AAAA

        - Name: !Sub "*.west.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: A
        - Name: !Sub "*.west.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: AAAA

        - Name: !Sub "*.west1.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: A
        - Name: !Sub "*.west1.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-1W1OF5U4X8M3Z-284373e0ff42a3aa.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: AAAA

  StagingWildcards:
    Type: AWS::Route53::RecordSetGroup
    Properties:
      Comment: Staging FTP domains
      HostedZoneId: !GetAtt HostedZone.Id
      RecordSets:
        # Staging traffic
        # - staging.prxtransfer.org
        # - *.staging.prxtransfer.org
        # - *.station.staging.prxtransfer.org
        # Does NOT support regional wildcard domains that used to be used in
        # production, such as *.east.staging.prxtransfer.org.
        #
        # No one should be using staging domains except for us for internal
        # testing
        - Name: !Sub staging.${Domain}
          AliasTarget:
            DNSName: infra-FtpSe-PVZ4TQZYADYA-dc6e2279abf01ee4.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: A
        - Name: !Sub staging.${Domain}
          AliasTarget:
            DNSName: infra-FtpSe-PVZ4TQZYADYA-dc6e2279abf01ee4.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: AAAA

        - Name: !Sub "*.staging.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-PVZ4TQZYADYA-dc6e2279abf01ee4.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: A
        - Name: !Sub "*.staging.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-PVZ4TQZYADYA-dc6e2279abf01ee4.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: AAAA

        - Name: !Sub "*.station.staging.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-PVZ4TQZYADYA-dc6e2279abf01ee4.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: A
        - Name: !Sub "*.station.staging.${Domain}"
          AliasTarget:
            DNSName: infra-FtpSe-PVZ4TQZYADYA-dc6e2279abf01ee4.elb.us-east-1.amazonaws.com
            EvaluateTargetHealth: true
            HostedZoneId: Z26RNL4JYFTOTI
          Type: AAAA
